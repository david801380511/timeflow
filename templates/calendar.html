{% extends "base.html" %}
{% block title %}Calendar{% endblock %}

{% block extra_css %}
<style>
  /* Custom scrollbar for calendar grid */
  #calendarGrid {
    grid-template-columns: 80px 1fr;
  }
  
  /* Month view styles */
  .month-day {
    min-height: 120px;
    transition: all 0.2s;
  }
  .month-day:hover {
    background-color: rgba(99,102,241,.05);
  }
  .dark .month-day:hover {
    background-color: rgba(99,102,241,.1);
  }
  .month-day.other-month {
    opacity: 0.4;
    background-color: rgba(243, 244, 246, 0.5);
  }
  .dark .month-day.other-month {
    background-color: rgba(31, 41, 55, 0.5);
  }
  .month-day.today {
    background-color: rgba(99,102,241,.1);
    border: 2px solid #6366f1;
  }
  .dark .month-day.today {
    background-color: rgba(99,102,241,.15);
    border-color: #818cf8;
  }
  
  /* Event dots */
  .event-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
    margin: 2px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }
  .event-dot.study { background-color: #3b82f6; }
  .event-dot.busy { background-color: #6b7280; }
  .event-dot.break { background-color: #22c55e; }

  /* Day view styles */
  .slot { 
    min-height: 60px; 
    border-bottom: 1px solid #e5e7eb; 
    padding: 4px 8px;
    position: relative;
  }
  .slot.selected { background-color: rgba(99,102,241,.15); }
  
  /* Scheduled blocks */
  .slot.scheduled-busy { background-color: rgba(107,114,128,.1); border-left: 4px solid #6b7280; }
  .slot.scheduled-study { background-color: rgba(59,130,246,.1); border-left: 4px solid #3b82f6; }
  .slot.scheduled-break { background-color: rgba(34,197,94,.1); border-left: 4px solid #22c55e; }
  
  .dark .slot { border-color: #374151; }
  .dark .slot.scheduled-busy { background-color: rgba(107,114,128,.2); }
  .dark .slot.scheduled-study { background-color: rgba(59,130,246,.2); }
  .dark .slot.scheduled-break { background-color: rgba(34,197,94,.2); }

  .block-pill {
    border-radius: 6px;
    padding: 4px 8px;
    font-size: 0.85rem;
    display: inline-flex;
    gap: 8px;
    align-items: center;
    font-weight: 500;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    width: 100%;
    justify-content: space-between;
  }
  
  .block-pill.busy { background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
  .block-pill.break { background: #dcfce7; color: #166534; border: 1px solid #86efac; }
  .block-pill.study { background: #dbeafe; color: #1e40af; border: 1px solid #93c5fd; }
  
  .dark .block-pill.busy { background: #374151; color: #e5e7eb; border-color: #4b5563; }
  .dark .block-pill.break { background: #064e3b; color: #dcfce7; border-color: #059669; }
  .dark .block-pill.study { background: #1e3a8a; color: #dbeafe; border-color: #2563eb; }
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Month View -->
  <div id="monthView" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300">
    <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex flex-col md:flex-row items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        <h1 id="monthLabel" class="text-2xl font-bold text-gray-900 dark:text-white"></h1>
        <div class="flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
          <button id="prevMonth" class="p-2 rounded-md hover:bg-white dark:hover:bg-gray-600 shadow-sm transition-all text-gray-600 dark:text-gray-300">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button id="todayMonthBtn" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-white dark:hover:bg-gray-600 rounded-md shadow-sm transition-all mx-1">Today</button>
          <button id="nextMonth" class="p-2 rounded-md hover:bg-white dark:hover:bg-gray-600 shadow-sm transition-all text-gray-600 dark:text-gray-300">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
      
      <div class="flex gap-3">
        <button id="autoScheduleBtn" class="flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg shadow-sm transition-colors font-medium text-sm">
          <i class="fas fa-robot"></i> Auto-Schedule
        </button>
        <button id="clearCalendarBtn" class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400 rounded-lg shadow-sm transition-colors font-medium text-sm">
          <i class="fas fa-trash-alt"></i> Clear
        </button>
      </div>
    </div>

    <div id="monthGrid" class="grid grid-cols-7 gap-px bg-gray-200 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-700">
      <!-- Day headers -->
      <div class="py-3 bg-gray-50 dark:bg-gray-800 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider text-center">Sun</div>
      <div class="py-3 bg-gray-50 dark:bg-gray-800 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider text-center">Mon</div>
      <div class="py-3 bg-gray-50 dark:bg-gray-800 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider text-center">Tue</div>
      <div class="py-3 bg-gray-50 dark:bg-gray-800 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider text-center">Wed</div>
      <div class="py-3 bg-gray-50 dark:bg-gray-800 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider text-center">Thu</div>
      <div class="py-3 bg-gray-50 dark:bg-gray-800 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider text-center">Fri</div>
      <div class="py-3 bg-gray-50 dark:bg-gray-800 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider text-center">Sat</div>
      <!-- Days are injected by JS -->
    </div>
  </div>

  <!-- Day View (hidden by default) -->
  <div id="dayView" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
    <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex flex-col md:flex-row items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        <button id="backToMonth" class="flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors text-sm font-medium">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <h1 id="dayLabel" class="text-2xl font-bold text-gray-900 dark:text-white"></h1>
      </div>
      
      <div class="flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
        <button id="prevDay" class="p-2 rounded-md hover:bg-white dark:hover:bg-gray-600 shadow-sm transition-all text-gray-600 dark:text-gray-300">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button id="nextDay" class="p-2 rounded-md hover:bg-white dark:hover:bg-gray-600 shadow-sm transition-all text-gray-600 dark:text-gray-300">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>

    <div id="calendarGrid" class="grid gap-0 bg-white dark:bg-gray-800 overflow-y-auto max-h-[800px]">
      <!-- Column headers -->
      <div class="sticky top-0 z-10 bg-gray-50 dark:bg-gray-800 border-b border-r border-gray-200 dark:border-gray-700 p-3 text-sm font-medium text-gray-500 dark:text-gray-400 text-right">Time</div>
      <div id="dayHead0" class="sticky top-0 z-10 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-3 text-sm font-medium text-gray-900 dark:text-white text-center"></div>
      <!-- The time rows + day slots are injected by JS -->
    </div>
  </div>
</div>

<!-- Create Block Modal -->
<div id="blockModal" class="hidden fixed inset-0 bg-gray-900/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50 flex items-center justify-center">
  <div class="relative bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full mx-4 overflow-hidden transform transition-all border border-gray-200 dark:border-gray-700">
    <div class="bg-indigo-600 px-6 py-4">
      <h3 class="text-lg font-semibold text-white flex items-center gap-2">
        <i class="fas fa-clock"></i> Create Block
      </h3>
    </div>
    <div class="p-6 space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Title</label>
        <input id="blkTitle" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white transition-colors" placeholder="e.g., Deep Work Session">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Type</label>
        <select id="blkType" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white transition-colors">
          <option value="busy">Busy (no study)</option>
          <option value="study">Study for assignment</option>
          <option value="break">Break</option>
        </select>
      </div>
      <div id="assignWrap" class="hidden">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Assignment</label>
        <select id="blkAssignment" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white transition-colors"></select>
      </div>
    </div>
    <div class="px-6 py-4 bg-gray-50 dark:bg-gray-700/50 flex justify-end gap-3 border-t border-gray-200 dark:border-gray-700">
      <button id="blkCancel" class="px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 font-medium transition-colors text-sm">Cancel</button>
      <button id="blkSave" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg shadow-sm font-medium transition-colors text-sm">Save Block</button>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', path='/js/calendar.js') }}?v={{ range(1, 99999) | random }}"></script>
{% endblock %}
